---
title: è¯´è¯´æˆ‘ä»¥å‰ä¸çŸ¥é“çš„git
date: 2020-04-03 23:14:50
categories:
  - The Hashmap
tags:
  - tech
---

ä¹‹å‰å’ŒåŒäº‹å› ä¸ºgitäº§ç”Ÿè¿‡ä¸å°‘çŸ›ç›¾ï¼Œæ¯æ¬¡æˆ‘éƒ½æœ‰ä¸€ç§â€œä½ çš„åšæ³•å¥½åƒå’Œæˆ‘æ‰€å¬è¯´è¿‡å…¶ä»–äººçš„åšæ³•ä¸å¤ªä¸€æ ·å¯æ˜¯æˆ‘åˆè¯´ä¸ä¸Šæ¥å“ªé‡Œä¸å¯¹â€çš„æ„Ÿè§‰ã€‚ä¸ºäº†èƒ½å¤Ÿé•¿ä¹…çš„åœ¨æŠ€æœ¯è®¨è®ºæ—¶ç«‹äºä¸è´¥ä¹‹åœ°ï¼ˆå¹¶ä¸æ˜¯ï¼‰ï¼Œæˆ‘åœ¨æ‰¿è¯ºç»™ç»„é‡Œå‘è¡¨ä¸€ä¸ªreportä»¥åå¼€å§‹å¸¦è–ªç ”ç©¶gitçš„æœ€ä½³æµç¨‹ã€‚

è¿™ä¸ªç ”ç©¶åšçš„å…¶å®æ¯”æƒ³è±¡ä¸­æ—¶é—´æ›´ä¹…ï¼Œå¯èƒ½æˆ‘çœŸçš„ä¸é€‚åˆåšresearchï¼ˆè¿˜å¥½æ²¡å»å­¦æœ¯ç•Œå•Šé˜¿å¼¥é™€ä½›ï¼‰ï¼Œç ”ç©¶æ¸…æ¥šæˆ‘å…·ä½“æƒ³è¦è§£å†³å“ªäº›é—®é¢˜å°±æƒ³äº†å¾ˆä¹…ã€‚æœ€ç»ˆæˆ‘ç®€å•ç²—æš´åœ°æŠŠç ”ç©¶è¯¾é¢˜å®šä¸º**How To Avoid Merge Conflicts**å¹¶å¼€å§‹åœ¨Googleä¸­è¿›è¡Œäº†graph searchï¼Œå‘ç°ç½‘ä¸Šèƒ½æ‰¾åˆ°çš„ç°æˆèµ„æ–™çš„è§£é‡Šéƒ½éå¸¸æµ®äºè¡¨é¢ï¼ˆæ¯”å¦‚æ€ä¹ˆä½¿ç”¨feature branchä¹‹ç±»ï¼Œè¿˜æœ‰è¦å°½é‡å¤šcommitå†™æ¸…æ¥šcommit messageç­‰ç­‰ï¼ŒåŸºæœ¬ä¸Šåœ¨ä¼ä¸šé‡Œç”¨è¿‡å‡ å¹´gitçš„éƒ½å¿ƒé‡Œæœ‰æ•°å§ï¼Ÿï¼‰ã€‚å†æœï¼Œå‘ç°å…¶å®æˆ‘æƒ³è¦çš„ä¿¡æ¯å…¨éƒ½åœ¨å®˜æ–¹æŒ‡å—[Pro Git Book](https://git-scm.com/book/en/v2)é‡Œé¢ï¼Œåªæ˜¯å­—å¤ªå¤šäº†å¯¼è‡´æˆ‘ä¸€å¼€å§‹æ¼çœ‹äº†å¾ˆå¤šå†…å®¹ğŸ˜‚

è¿™å‡ å¤©å·¦å³æ— äº‹ï¼Œå‡†å¤‡æŠŠè¿˜è®°å¾—çš„éƒ¨åˆ†èµ¶å¿«ç”¨ä¸­æ–‡è‡ªå·±è®°å½•ä¸€ä¸‹ï¼Œç®—æ˜¯ç»™è‡ªå·±å’Œéœ€è¦çš„å°ä¼™ä¼´ä»¬å†ç§‘æ™®ä¸€æ¬¡ï¼Œä¹Ÿæ˜¯æˆ‘å¼€åšä»¥æ¥ç¬¬äºŒç¯‡æŠ€æœ¯å¹²è´§å•¦å•¦å•¦ï½æƒ³è·³è¿‡è¿‡ç¨‹/åŸç†ç­‰ç­‰ç›´æ¥çœ‹ç»“è®ºçš„ï¼Œè¯·ç›´æ¥è·³åˆ°æœ€åä¸€ä¸ªsectionå¹¶ä¸”æ¬¢è¿æ¥æ€¼ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ä¸€å®¶ä¹‹è¨€ğŸ˜‚

### Commit, Tree & Blob

è®²çœŸï¼Œåœ¨æˆ‘ç”¨gitå‘½ä»¤è¡Œçš„å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œæ ¹æœ¬ä¸çŸ¥é“treeå’Œblobæ˜¯ä»€ä¹ˆï¼Œå¯¹äºcommitçš„äº†è§£ä¹Ÿä»…é™äºâ€œä¿ç•™äº†è¿™ä¸ªé¡¹ç›®çš„æŸä¸ªç‰ˆæœ¬â€ã€‚ç›´åˆ°æˆ‘å¼€å§‹åœ¨å¤©å°‘çš„æ¨èä¸‹ç”¨èµ·äº†gitå®¢æˆ·ç«¯æ‰å‘ç°å±…ç„¶è¿˜æœ‰tree/blobä¹‹ç±»çš„ä¸œè¥¿ã€‚æ¯”å¦‚è¯´å¦‚æœä½ ç”¨`git ls-tree [commit-sha]`è¿™ä¸ªå‘½ä»¤ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„ä¸œè¥¿â€¦â€¦

```
$ git ls-tree 0ab925e1f445e535fe5b0a936b0facc867fcf149
100644 blob 660170cc0ca2fd12955558577479d6599424f7e9	.gitignore
100644 blob f6d0daa4437cc3cc01f7b29fa2848d0fe9e4871f	CONTRIBUTING.md
040000 tree 1e3c518fe4933da3dfbfc37819d310552fe2b0eb	Dionysus.xcodeproj
040000 tree 37b1877603d7854991120cd677ea09efab33a393	Dionysus
040000 tree f83fd13949bf60d50db0a00f3259680f6d83c304	DionysusTests
040000 tree d5d5bdffe207a6a3c5a07ce376f1d5295959e254	DionysusUITests
100644 blob 9b3ac0e3f3c79ef5036bf9df37ea1da59289ff1a	Podfile
100644 blob 8dca0ef160daa18316a9e51da5d5da8dbddd71bc	README.md
```
åŒæ ·çš„å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨åœ¨tree/blob shaä¸Šé¢ï¼Œæ¯”å¦‚è¯´æˆ‘ç”¨ä¸Šé¢ç»“æœç¬¬å››è¡Œé‚£ä¸€å¤§ä¸²ä½œä¸ºè¾“å…¥ï¼Œè°ƒç”¨åŒä¸€ä¸ªå‘½ä»¤
```
$ git ls-tree 37b1877603d7854991120cd677ea09efab33a393
100644 blob 7aad2e58f45aa609b78876aa30d3d759c44ee064	APIKeys_sample.swift
100644 blob 7fa1df09658fa0b3444785131f7c3389bf2f99b0	AppDelegate.swift
040000 tree a81076cc287adc42b745453dde5ce18299d395a9	Assets.xcassets
040000 tree f3c26079372eb516f03fad967cbe8e0eab5bc5d7	Base.lproj
100644 blob f4912c947b75992aaf1e8e486956bc25bc935ee1	Info.plist
040000 tree d4373b5b8be66ef42fe9f750d26bb834b51b93af	Preview Content
100644 blob e5544eedf22df7c9c82603211b56d2faa306d67c	RootView.swift
100644 blob f12e5d831957b545fbc473356c4a5575368b1385	SceneDelegate.swift
040000 tree 590fbf29e542792b2cf89eb2d9e055cb1fb795c8	core
040000 tree ed1593c5cb4ba63e36cb7cddaa5f0eecf8774f1d	views
```

æ‰€ä»¥è¿™äº›éƒ½æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ

**blob**æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯æŸä¸ªæ–‡ä»¶çš„æŸä¸ªç‰ˆæœ¬ã€‚æ¯”å¦‚è¯´æˆ‘ä¸€ä¸ªrepositoryæœ‰helloworld.txtï¼Œåæ¥æŸæ¬¡æäº¤äº†å¯¹è¿™ä¸ªæ–‡ä»¶çš„æ”¹åŠ¨ã€‚é‚£ä¹ˆåœ¨è¿™æ¬¡æäº¤ä¹‹å‰çš„commitså°±ä¼šæŒ‡å‘helloworld-blob-1ï¼Œä¹‹åçš„å°±ä¼šæŒ‡å‘helloworld-blob-2ï¼Œç›´åˆ°å†æ”¹ä¸ºæ­¢ã€‚

**tree**æ ¹æ®å®˜æ–¹è¯´æ³•å°±æ˜¯ä¸€ä¸ªç±»ä¼¼Unix file systemçš„å­˜åœ¨ï¼Œä»£è¡¨æŸæ–‡ä»¶å¤¹çš„æŸç‰ˆæœ¬ã€‚æ¯”å¦‚è¯´ä¸Šé¢è¿™ä¸€æ®µè¾“å‡ºçš„æ„æ€å°±æ˜¯åœ¨ç›®å‰ç‰ˆæœ¬çš„Dionysusæ–‡ä»¶å¤¹ä¸­ï¼Œæœ‰7aad2e...ç‰ˆæœ¬çš„APIKeys_sample.swiftç­‰ç­‰æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜æœ‰å‡ ä¸ªæ–‡ä»¶å¤¹æ¯”å¦‚è¯´a81076...ç‰ˆæœ¬çš„Assets. è¯è¯´æˆ‘è¿™ä¹‹å‰ä¸€ç›´æ²¡æ€ä¹ˆææ‡‚è¿™æ˜¯å•¥ï¼Œå†™è¿™æ®µæ–‡å­—çš„æ—¶å€™çªç„¶ç§’æ‡‚ï¼Œå‚è€ƒåä¾¦æ¢æŸ¯å—åè„‘å‹ºåˆ’è¿‡ä¸€é“é—ªç”µâ€¦â€¦

è¯è¯´æ¯ä¸ª**commit**ä¹Ÿæ˜¯æŒ‡å‘ä¸€ä¸ªtreeçš„ï¼Œå°±æ˜¯repositoryæ ¹ç›®å½•å½“å‰ç‰ˆæœ¬çš„tree. æ‰€ä»¥è¯´æ¯ä¸ªcommitå®é™…ä¸Šæ ¹æœ¬ä¸åƒæˆ‘ä¹‹å‰ä»¥ä¸ºçš„æ˜¯ä¸€å¤§å¸®code diffï¼Œè€Œæ˜¯â€¦â€¦

> The pointer to the top-level tree for the **snapshot** of the project at that point.

æ˜¯æ•´ä¸ªé¡¹ç›®çš„å¿«ç…§å•Šå•Šå•Šå•Šâ€¦â€¦æˆ‘å¤§æ¦‚æ˜¯å› ä¸ºå¹³æ—¶rebaseç”¨çš„å¤ªå¤šæ‰ä¼šå¤©çœŸçš„ä»¥ä¸ºæ¯ä¸ªcommitæ˜¯ä¸€å †code diffå§ï¼

### Conflictsæ˜¯å¦‚ä½•äº§ç”Ÿçš„

ä¸€èˆ¬æƒ…å†µä¸‹æŠŠä¸¤ä¸ªé”™å¼€çš„åˆ†æ”¯æä¸€å—å„¿æ— éä¸¤æ‹›ï¼Œmerge & rebase.ï¼ˆä¹‹æ‰€ä»¥å¼ºè°ƒâ€œé”™å¼€çš„â€åˆ†æ”¯æ˜¯å› ä¸ºæˆ‘ä¸æƒ³è®¨è®ºæ— å…³ä¸»é¢˜çš„fast forward mergingï¼‰

ä¸ºäº†è§£é‡ŠåŸç†æˆ‘ä»¬å…ˆå‡è®¾è¿™ä¹ˆä¸€ä¸ªåœºæ™¯â€”â€”æŸä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€è¡Œ"hello world"

1. çˆ±ä¸½ä¸å°å§å§æŠŠhelloæ”¹æˆäº†å¤§å†™
2. é²å‹ƒå°å“¥å“¥å…ˆæŠŠworldåˆ äº†ï¼Œcommitï¼Œå†æŠŠworldåŠ äº†å›æ¥ï¼Œcommitï¼Œæœ€ååŠ äº†ä¸ªæ„Ÿå¹å·ï¼Œcommit.

#### Three-Way Merge

åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä¸¤ä¸ªcommitçš„å¿«ç…§å¯¹æ¯”ä¸€ä¸‹ï¼Œå“ªè¡Œå‡ºç°äº†å¤šä¸ªç‰ˆæœ¬ï¼Œå°±è§£å†³å“ªè¡Œçš„conflictï¼Œè§£å†³å®Œåäº§ç”Ÿæ–°çš„blob/treeå¹¶ä»¥æ­¤å»ºç«‹ä¸€ä¸ªæ–°çš„merge commitã€‚

æ¯”å¦‚è¦mergeä¸Šé¢ä¿©å°ä¼™ä¼´çš„ä»£ç ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µâ€”â€”merge conflict between "Hello world" and "hello world!"ï¼Œæ‰€ä»¥è¿™è¡Œåˆ°åº•åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿäºæ˜¯æˆ‘æŠŠè¿™è¡Œæ”¹æˆ"Hello world!"æäº¤å³å¯ã€‚

ç»“è®ºï¼šä½ åªç”¨è§£å†³ä¸€æ¬¡conflictã€‚

#### Rebase

Rebaseæ¯”mergeçƒ¦å¤ªå¤šäº†ï¼Œå› æ­¤è®©ä¸šç•Œå¾ˆå¤šå°ä¼™ä¼´æ„Ÿåˆ°å¤´ç–¼ã€‚Rebaseçš„å·¥ä½œåŸç†å°±æ˜¯â€”â€”**çœŸçš„æç‚¼å‡ºæ¯ä¸ªcommitçš„code diffï¼Œç„¶åæŒ‰é¡ºåºæŠŠè¿™äº›code diffåœ¨å¦ä¸€ä¸ªåˆ†æ”¯ä¸Šé‡å¤ä¸€éã€‚**

æ¯”å¦‚ä¸Šé¢æƒ…å†µï¼Œå‡è®¾é²å‹ƒå°å“¥æƒ³è¦rebase ontoçˆ±ä¸½ä¸å°å§å§çš„åˆ†æ”¯ï¼Œé‚£ä¹ˆåœ¨ä»–è¾“å…¥å‘½ä»¤å›è½¦çš„ç¬é—´gitä¼šé—®ä»–â€”â€”å¥¹çš„ç‰ˆæœ¬æ˜¯"Hello world"ä½ çš„ç‰ˆæœ¬æ˜¯"hello"ï¼Œè¯·é—®ä½ é€‰å“ªä¸ªï¼Ÿ

- å¦‚æœé€‰é²å‹ƒç‰ˆæœ¬"hello"ï¼Œé‚£ä¹ˆçˆ±ä¸½ä¸é‚£ä¸ªcommitå¤§æ¦‚è¦ä½œåºŸäº†ã€‚
- å¦‚æœé€‰çˆ±ä¸½ä¸ç‰ˆæœ¬"Hello world"ï¼Œé‚£ä¹ˆç­‰ä½œç”¨ä¸‹ä¸€ä¸ªcommitçš„æ—¶å€™gitåˆä¼šé—®ä¸€éï¼Œâ€œHello worldâ€å’Œâ€œhello worldâ€ä½ é€‰å“ªä¸ªï¼Ÿå¦‚æœé€‰äº†å‰è€…çš„è¯ï¼Œå¯èƒ½åé¢è¿˜è¦å†é—®ä¸€é"Hello world"å’Œâ€œhello world!â€ä½ é€‰å“ªä¸ªâ€¦â€¦
- å¦‚æœç›´æ¥åœ¨è¿™é‡Œæ”¹æˆ"Hello"é‚£ä¹ˆå’Œé€‰"Hello world"ä¸€æ ·ï¼Œæ¥ä¸‹æ¥æ¯æ¬¡ä½œç”¨æ–°çš„commitï¼Œä»–å°±è¦ä¿®ä¸€æ¬¡merge conflictï¼Œå®æƒ¨

ç»“è®ºï¼šä½ è¦è§£å†³O(n)æ¬¡conflictã€‚

å½“ç„¶ç›®å‰ä¸šç•Œæ˜æ˜¾æ˜¯åçˆ±rebaseå¤šäºmergeçš„ï¼Œç†ç”±æ˜¾è€Œæ˜“è§ï¼Œæ¯•ç«Ÿäº‹åå‡ºäº†é—®é¢˜debugèµ·æ¥ä¸è¦æ¯”mergeå®¹æ˜“æ›´å¤šå•Šï½æƒ³è±¡ä¸€ä¸‹æˆ‘å‘ç°æŸä¸€è¡Œæœ‰bugï¼Œæ€’è¾“å…¥git blameå›è½¦ï¼Œç»“æœä¸€çœ‹ç‰¹ä¹ˆçš„"Merge branch feature-XXX..."è€Œä¸”å½“ä½ æ’æŸ¥feature-XXXçš„æ—¶å€™å¾ˆå¯èƒ½bugæ¶ˆå¤±äº†ï¼Œä½ è¯´æ°”ä¸æ°”ï¼Ÿè€Œä¸”gitè¿˜æœ‰ä¸ªæˆ‘æ²¡ç”¨è¿‡çš„ç¥å™¨å«git bisectï¼ŒäºŒåˆ†æŸ¥æ‰¾debugçš„ï¼Œé‚£ä½ è¦èƒ½äºŒåˆ†æŸ¥æ‰¾å²‚ä¸æ˜¯å¾—ä¿è¯commit logå¾—æ˜¯çº¿æ€§çš„å˜›ã€‚

#### Squash

å› æ­¤æˆ‘è¿˜ç ”ç©¶äº†ä¸€ä¸‹ä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨squashã€‚æ¯”å¦‚é²å‹ƒå°å“¥å“¥å¦‚æœåœ¨rebaseä¹‹å‰æŠŠä»–çš„ä¸‰ä¸ªcommitéƒ½squashäº†ï¼Œé‚£å°±å¥½åŠäº†ï¼Œrebaseçš„æ—¶å€™è§£å†³ä¸€æ¬¡conflictå³å¯ã€‚

é‚£é—®é¢˜æ¥äº†ï¼Œä¸‡ä¸€ä»–æäº¤å®Œç¬¬ä¸€ä¸ªç¬¬äºŒä¸ªcommitä»¥åï¼Œæˆ‘ä»ä»–çš„åˆ†æ”¯åˆèµ·äº†ä¸ªåˆ†æ”¯å¹¶ä¸”æäº¤äº†nä¸ªcommitã€‚å½“æˆ‘æƒ³é‡æ–°æŠŠè‡ªå·±çš„åˆ†æ”¯mergeå›ä»–çš„åˆ†æ”¯çš„æ—¶å€™ï¼ˆæ³¨æ„æ˜¯mergeï¼Œä¸æ˜¯rebaseï¼‰ï¼Œå‘ç°ä»–ç«Ÿç„¶squashäº†â€¦â€¦ç„¶åé—®é¢˜å°±æ¥äº†ï¼Œæˆ‘çš„branché‡Œé¢è¿˜æœ‰ä»–rebaseä¹‹å‰çš„commitså‘€ï¼Œç›´æ¥mergeçš„è¯ä¼šå‡ºç°ä¸€ä¸ªâ€œåŒä¸€ç‰ˆä»£ç åœ¨git historyä¸­ä»¥ä¸åŒçš„shaå‡ºç°ä¸¤æ¬¡â€çš„è¯¡å¼‚æƒ…å†µâ€¦â€¦

### å¦‚ä½•è§£å†³conflicts

æˆ‘æ˜¯è¿™ä¹ˆæƒ³çš„â€”â€”ä¸€åˆ‡å–å†³äºä½ çš„åˆ†æ”¯ä¸Šè¿˜æœ‰æ²¡æœ‰å…¶ä»–åˆ†æ”¯ã€‚

- æ²¡æœ‰çš„è¯ï¼Œæ”¾å¿ƒsquash and rebaseï¼Œä¸€æ¬¡æ€§è§£å†³å…¨éƒ¨conflictsï¼Œè¿˜èƒ½ç­æ‰å¾ˆå¤š"fix typo"ä¹‹ç±»çš„é¸¡è‚‹commit message.
- æœ‰è€Œä¸”å…¶ä»–åˆ†æ”¯ä¸Šæœ‰æ¯”è¾ƒå¤šæ¯”è¾ƒå¤§çš„æ”¹åŠ¨çš„è¯ï¼Œç›´æ¥ç”¨mergeï¼Œä¸è¦å†é‡æ–°ç”Ÿæˆä¸€å †æ–°çš„commitsã€‚æ¯•ç«Ÿè¿™ä¸ªåˆ†æ”¯æœ¬æ¥å°±æ˜¯ä½œä¸ºä¸€ä¸ªï¼Œå—¯â€”â€” æ¯èŠ‚ç‚¹ï¼ˆï¼Ÿï¼‰è€Œä¸æ˜¯å­èŠ‚ç‚¹è€Œå­˜åœ¨çš„ï¼Œä»¥åçœ‹git logçš„æ—¶å€™èƒ½å¤Ÿè¯šå®ååº”å„ç§dependenciesä¸æ˜¯ä¹ŸæŒºå¥½çš„å˜›ã€‚

å¼•ç”¨Pro Git Bookä¸Šä¸€å¥ç®´è¨€â€”â€”

> Do not rebase commits that exist outside your repository and that people may have based work on.

ç„¶è€Œæˆ‘ç°åœ¨è¾èŒäº†ï¼Œå¤§æ¦‚ä¹Ÿä¸ä¼šæƒ³äº‹åè¯¸è‘›äº®åœ°å›å»battleå‰åŒäº‹äº†ã€‚ä¸çŸ¥é“ä»¥åèƒ½ä¸èƒ½ç”¨æ¥æ€¼æ–°åŒäº‹â€¦â€¦
